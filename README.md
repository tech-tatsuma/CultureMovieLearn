# SlowFastNetworksを使った動画分類
## 学習環境の構築
### 学習環境の立ち上げ
```
sudo docker build -t culturevideolearn .
```
### 学習環境の開始
```
sudo docker run --rm -it --gpus all -v $PWD:/culturevideolearn culturevideolearn:latest
```
## create_data.py
<h4>動画分割とラベル付けスクリプト</h4>
このスクリプトは動画を１秒間隔のセグメントに分割し、それらにラベルをつけてcsvファイルに出力するために使用されるものです。このスクリプトは動画の機械学習のデータの準備に利用されます。

### Requirements
・Python 3

・moviepy: 動画の読み込みと分割に使用

・pandas: データ操作とCSVファイルの作成に使用

・argparse: コマンドライン引数の処理に使用
### 実行方法
<h4>データの作成</h4>
```
python create_data.py --video_path [動画ファイルへのパス] --timeline_csv_path [タイムラインCSVファイルへのパス] --output_folder [出力ディレクトリへのパス]
```

- --video_path: 処理する動画ファイルへのパス
- --timeline_csv_path: 動画の各セグメントに対応するラベルが記述されたCSVファイルへのパス
- --output_folder: 分割された動画ファイルとラベル付けされたCSVを保存するディレクトリへのパス
<h4>データの学習</h4>
カスタムSlowFastネットワークを用いて動画分類モデルを訓練します。このモデルは動画内の早い動きと遅い動きの両方を捉えることができるため、動画分類に特に効果的です。

- PyTorch Hubから事前に学習されたSlowFastモデルをロードし、最終分類層を指定されたクラス数に合わせて調整します。
- 入力動画データを適切な出力（クラス予測）に変換するためのforwardメソッドが定義されています。
- データの前処理、モデルの初期化、オプティマイザーの設定、訓練ループ、早期停止のロジックなどが含まれています。
- コマンドライン引数を使用して訓練オプションを指定できます。
### Note

- タイムラインCSVファイルは、各行に時間,ラベルの形式で記述されている必要があります。
- 出力されるCSVファイルには、各セグメントのファイルパスと対応するラベルが含まれます。
## Model
### CustomSlowFastネットワーク
このネットワークは、動画分類のためのSlowFastネットワークアーキテクチャを使用したカスタムニューラルネットワークです。SlowFastモデルは動画内の早い動きと遅い動きの両方を捉えることができるため、動画分類に特に効果的です。

- torch.hub.loadを用いてPyTorch Hubから事前に学習されたSlowFastモデル (slowfast_r50) をロードします。この事前学習されたモデルは、動画分類タスクにおける高い性能を発揮します。
- モデルの最終分類層の入力特徴量数を取得し、新しい線形層に置き換えます。この線形層は指定されたクラス数（デフォルトでは2）に対応し、動画データから特定のカテゴリを識別するために使用されます。
- forwardメソッドは、入力データをネットワークを通して順伝播させる機能を定義します。このメソッドにより、入力動画データは適切な出力（クラス予測）に変換されます。
- このカスタムクラスは、特定のビデオ分類タスクの要件に合わせて、事前学習されたモデルを調整し再利用することを可能にします。このアプローチにより、学習時間の短縮とモデルの性能向上が期待できます。